# 1.1_起点.md

这是一个影片出租店用的程序，计算每一位顾客的消费金额并打印详单。操作者告诉程序：顾客租用了哪些影片、租期多长，程序便根据租赁时间和影片类型算出费用。影片分为三类：普通片、儿童片和新片。除了计算费用，还要为常客计算积分，积分会根据租片种类是否为新片而有所不同。

以下为一张 UML 类图：

![1_1_UML_类图](http://q1nz3e771.bkt.clouddn.com/1_1_UML%E7%B1%BB%E5%9B%BE.png)

反面教材的代码：

![1_2_反面教材](http://q1nz3e771.bkt.clouddn.com/1_1_%E5%8F%8D%E9%9D%A2%E6%95%99%E6%9D%90_code.png)

这个起始程序给你留下什么印象？我会说它涉及得不好，而且很明显不符合面向对象精神。

Customer 里头那个长长的 `statement()` 做的事情实在太多了，它做了很多原本应该由其他类完成的事情。

在这个例子里，用户希望对系统做一点修改。他们希望以 HTML 格式输出，看看代码就会发现，这根本不可能在打印 HTML 报表的函数中复用目前 `statement()` 的任何行为。

你心里牢牢记着那句古老的工程谚语：如果它没坏，就不要动它。这个程序也许还没坏道，但它造成了伤害。它让你的生活比较难过，因为你发现很难完成客户所需的修改。这时候，重构技术就该粉墨登场了。

> 如果发现自己需要为程序添加一个特性，而代码结构使你无法很方便地达成目的，那就先重构那个程序，使特性的添加比较容易进行，然后再添加特性。

