# 1.3 分解并重组 statement()

代码块越小，代码的功能就越容易管理，代码的处理和移动也就越轻松

第一个步骤就是找出代码的逻辑泥团并运用 `extract method(110)`。本例一个明显的逻辑泥团就是 switch 语句，把它提炼到独立函数中似乎比较好。

和任何重构手法一样，当提炼一个函数时，必须知道可能出什么错。重构之前需要想出安全做法。

任何不会被修改的变量都可以被当成参数传入新的函数。

如果只有一个变量会被修改，可以把它当做返回值。

重构步骤的本质：每次修改的幅度都很小，所以任何错误都很容易发现。不必耗费大把时间调试。

> 重构技术就是以微笑的步伐修改程序，如果犯下错误，很容易便可发现它。

由于使用的是 Java，需要对代码做一些分析，决定如何处理局部变量。如果拥有相应的工具，smalltalk 就拥有这样的工具：Refactoring Browser。运用这个工具，重构过程非常轻松，只需要标识出需要重构的代码，选择 `Extract Method`，输入新的函数名称，一切就自动搞定。

更改变量名称是值得的行为吗？绝对值得，好的代码应该清楚地表达出自己的功能，变量名称是代码清晰的关键。

> 任何一个人都能写出计算机可以理解的代码，唯有写出人类容易理解的代码，才是优秀的程序员。

绝大多数情况下，函数应该放在它所使用的数据的所属对象内。

做完修改之后，下一件事就是去掉旧函数。

尽量去除临时变量。临时变量往往引发问题，会导致大量参数被传来传去，而其实完全没有这种必要。当然这么做也需付出性能上的代价，但是这很容易被优化，而且如果代码有合理的组织和管理，优化就会有很好的效果。

对比修改前后的序列图：

![序列图1](http://q1nz3e771.bkt.clouddn.com/1_3_%E5%BA%8F%E5%88%97%E5%9B%BE1.png)

![序列图2](http://q1nz3e771.bkt.clouddn.com/1_3_%E5%BA%8F%E5%88%97%E5%9B%BE2.png)

## 去除临时变量

临时变量可能是个问题，它们只在自己所属的函数中有效，所以他们会助长冗长而复杂的函数。可以运用 Replace Temp With Query 并利用查询函数来取代临时变量。

可以把处理表头（header）、表尾（footer）和详单细目的代码分别都提炼出来，在 Form Template Method 可以看到如何做这些动作。

